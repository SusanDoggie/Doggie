sudo: true
dist: trusty
language: c

compiler:
  - clang
  
os:
  - linux
  - osx

osx_image: xcode8

env:
  - TOOLCHAIN="swift-DEVELOPMENT-SNAPSHOT-2016-07-28-a"
  
before_install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
        brew update;
    fi 
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
        sudo apt-get update;
        sudo apt-get install -y clang-3.6;
        sudo update-alternatives --install /usr/bin/clang clang /usr/bin/clang-3.6 100;
        sudo update-alternatives --install /usr/bin/clang++ clang++ /usr/bin/clang++-3.6 100;
        sudo apt-get install -y autoconf libtool libkqueue-dev libkqueue0 libcurl4-openssl-dev libbsd-dev libblocksruntime-dev g++-4.8 gcc-4.8;
        sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.8 200;
        sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.8 200;
    fi

install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
        wget https://swift.org/builds/development/xcode/${TOOLCHAIN}/${TOOLCHAIN}-osx.pkg;
        pkgutil --expand ${TRAVIS_BUILD_DIR}/${TOOLCHAIN}-osx.pkg ${TRAVIS_BUILD_DIR}/${TOOLCHAIN}-osx.unpkg;
        cat ${TRAVIS_BUILD_DIR}/${TOOLCHAIN}-osx.unpkg/${TOOLCHAIN}-osx-package.pkg/Payload | gunzip -dc |cpio -i;
        export PATH=${TRAVIS_BUILD_DIR}/usr/bin:"${PATH}";
    fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
        wget https://swift.org/builds/development/ubuntu1404/${TOOLCHAIN}/${TOOLCHAIN}-ubuntu14.04.tar.gz;
        tar xzf ${TOOLCHAIN}-ubuntu14.04.tar.gz;
        export PATH=${TRAVIS_BUILD_DIR}/${TOOLCHAIN}-ubuntu14.04/usr/bin:"${PATH}";
        git clone -b master https://github.com/apple/swift-corelibs-libdispatch.git;
        cd swift-corelibs-libdispatch && git submodule init && git submodule update && sh ./autogen.sh && CFLAGS=-fuse-ld=gold ./configure --with-swift-toolchain=${TRAVIS_BUILD_DIR}/${TOOLCHAIN}-ubuntu14.04/usr --prefix=${TRAVIS_BUILD_DIR}/${TOOLCHAIN}-ubuntu14.04/usr && make && make install;
        cd -;
    fi

script:
  - swift build
  - .build/debug/Doggie
